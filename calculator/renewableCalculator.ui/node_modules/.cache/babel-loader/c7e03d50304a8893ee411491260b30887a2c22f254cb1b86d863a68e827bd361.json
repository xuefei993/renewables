{"ast":null,"code":"import React,{useState,useEffect}from'react';import{weatherService}from'../../../services/weatherService';import ChartRenderer from'./chart/ChartRenderer';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ClimateChart=_ref=>{let{latitude,longitude,location}=_ref;const[climateData,setClimateData]=useState(null);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState('');const[tooltip,setTooltip]=useState({show:false,x:0,y:0,content:''});const[debugInfo,setDebugInfo]=useState('');const[dataSource,setDataSource]=useState('');const[sourceMessage,setSourceMessage]=useState('');useEffect(()=>{if(latitude&&longitude){fetchClimateData();}},[latitude,longitude]);const fetchClimateData=async()=>{setIsLoading(true);setError('');setClimateData(null);setDebugInfo('');setDataSource('');setSourceMessage('');try{console.log('Fetching climate data...');setDebugInfo(\"Requesting data for: \".concat(latitude,\", \").concat(longitude));const result=await weatherService.getCompleteClimateData(latitude,longitude,location);if(result.success){setClimateData(result.data);setDataSource(result.source);setSourceMessage(result.message);setDebugInfo(\"Successfully loaded data: \".concat(result.data.solar.length,\" solar points, \").concat(result.data.temperature.length,\" temperature points\"));console.log('Climate data loaded successfully:',result.data);}else{setError(result.error||'Failed to fetch climate data');setDebugInfo(\"API Error: \".concat(result.error));console.error('Climate data fetch failed:',result.error);}}catch(err){const errorMsg='Failed to fetch climate data: '+err.message;setError(errorMsg);setDebugInfo(\"Exception: \".concat(err.message));console.error('Climate data fetch error:',err);}finally{setIsLoading(false);}};const showTooltip=(e,month,solarValue,tempValue)=>{setTooltip({show:true,x:e.clientX,// 使用鼠标的全局X位置\ny:e.clientY,// 使用鼠标的全局Y位置\ncontent:{month,solar:solarValue.toFixed(1),temperature:tempValue.toFixed(1)}});};const hideTooltip=()=>{setTooltip({show:false,x:0,y:0,content:''});};// 占位符状态\nif(!latitude||!longitude){return/*#__PURE__*/_jsx(\"div\",{className:\"climate-chart-placeholder\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Select a location to view climate data\"})});}// 加载状态\nif(isLoading){return/*#__PURE__*/_jsxs(\"div\",{className:\"climate-chart-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\",children:\"Loading\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Fetching climate data from NASA POWER and Open-Meteo...\"}),/*#__PURE__*/_jsx(\"small\",{children:\"This may take a few seconds\"}),debugInfo&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'0.5rem',fontSize:'0.8rem',color:'#666'},children:debugInfo})]});}// 错误状态\nif(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"climate-chart-error\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Warning: \",error]}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchClimateData,className:\"btn btn-secondary\",children:\"Try Again\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'1rem'},children:[/*#__PURE__*/_jsxs(\"small\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Troubleshooting:\"}),/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Check your internet connection\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 The APIs may be temporarily unavailable\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Some locations may not have complete data coverage\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Location: \",latitude,\", \",longitude]}),debugInfo&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'0.5rem',fontSize:'0.8rem',color:'#666',fontFamily:'monospace'},children:[\"Debug: \",debugInfo]})]})]});}// 计算数据年份范围用于显示\nconst currentYear=new Date().getFullYear();const endYear=currentYear-1;const startYear=endYear-4;// 5年数据\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"climate-chart-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chart-header\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"5-Year Average Climate Data for \",location]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Historical data (\",startYear,\"-\",endYear,\") from\",' ',/*#__PURE__*/_jsx(\"a\",{href:\"https://power.larc.nasa.gov/\",target:\"_blank\",rel:\"noopener noreferrer\",children:\"NASA POWER\"}),' ',\"and\",' ',/*#__PURE__*/_jsx(\"a\",{href:\"https://open-meteo.com/\",target:\"_blank\",rel:\"noopener noreferrer\",children:\"Open-Meteo\"}),' ',\"APIs\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chart-content\",children:/*#__PURE__*/_jsx(ChartRenderer,{climateData:climateData,tooltip:tooltip,showTooltip:showTooltip,hideTooltip:hideTooltip})})]});};export default ClimateChart;","map":{"version":3,"names":["React","useState","useEffect","weatherService","ChartRenderer","jsx","_jsx","jsxs","_jsxs","ClimateChart","_ref","latitude","longitude","location","climateData","setClimateData","isLoading","setIsLoading","error","setError","tooltip","setTooltip","show","x","y","content","debugInfo","setDebugInfo","dataSource","setDataSource","sourceMessage","setSourceMessage","fetchClimateData","console","log","concat","result","getCompleteClimateData","success","data","source","message","solar","length","temperature","err","errorMsg","showTooltip","e","month","solarValue","tempValue","clientX","clientY","toFixed","hideTooltip","className","children","style","marginTop","fontSize","color","onClick","fontFamily","currentYear","Date","getFullYear","endYear","startYear","href","target","rel"],"sources":["/Users/xuefei/renewables/calculator/renewableCalculator.ui/src/components/steps/address-input/ClimateChart.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { weatherService } from '../../../services/weatherService';\nimport ChartRenderer from './chart/ChartRenderer';\n\nconst ClimateChart = ({ latitude, longitude, location }) => {\n  const [climateData, setClimateData] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [tooltip, setTooltip] = useState({ show: false, x: 0, y: 0, content: '' });\n  const [debugInfo, setDebugInfo] = useState('');\n  const [dataSource, setDataSource] = useState('');\n  const [sourceMessage, setSourceMessage] = useState('');\n\n  useEffect(() => {\n    if (latitude && longitude) {\n      fetchClimateData();\n    }\n  }, [latitude, longitude]);\n\n  const fetchClimateData = async () => {\n    setIsLoading(true);\n    setError('');\n    setClimateData(null);\n    setDebugInfo('');\n    setDataSource('');\n    setSourceMessage('');\n\n    try {\n      console.log('Fetching climate data...');\n      setDebugInfo(`Requesting data for: ${latitude}, ${longitude}`);\n      \n      const result = await weatherService.getCompleteClimateData(latitude, longitude, location);\n      \n      if (result.success) {\n        setClimateData(result.data);\n        setDataSource(result.source);\n        setSourceMessage(result.message);\n        setDebugInfo(`Successfully loaded data: ${result.data.solar.length} solar points, ${result.data.temperature.length} temperature points`);\n        console.log('Climate data loaded successfully:', result.data);\n      } else {\n        setError(result.error || 'Failed to fetch climate data');\n        setDebugInfo(`API Error: ${result.error}`);\n        console.error('Climate data fetch failed:', result.error);\n      }\n    } catch (err) {\n      const errorMsg = 'Failed to fetch climate data: ' + err.message;\n      setError(errorMsg);\n      setDebugInfo(`Exception: ${err.message}`);\n      console.error('Climate data fetch error:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const showTooltip = (e, month, solarValue, tempValue) => {\n    setTooltip({\n      show: true,\n      x: e.clientX, // 使用鼠标的全局X位置\n      y: e.clientY, // 使用鼠标的全局Y位置\n      content: {\n        month,\n        solar: solarValue.toFixed(1),\n        temperature: tempValue.toFixed(1)\n      }\n    });\n  };\n\n  const hideTooltip = () => {\n    setTooltip({ show: false, x: 0, y: 0, content: '' });\n  };\n\n  // 占位符状态\n  if (!latitude || !longitude) {\n    return (\n      <div className=\"climate-chart-placeholder\">\n        <p>Select a location to view climate data</p>\n      </div>\n    );\n  }\n\n  // 加载状态\n  if (isLoading) {\n    return (\n      <div className=\"climate-chart-loading\">\n        <div className=\"loading-spinner\">Loading</div>\n        <p>Fetching climate data from NASA POWER and Open-Meteo...</p>\n        <small>This may take a few seconds</small>\n        {debugInfo && (\n          <div style={{ marginTop: '0.5rem', fontSize: '0.8rem', color: '#666' }}>\n            {debugInfo}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  // 错误状态\n  if (error) {\n    return (\n      <div className=\"climate-chart-error\">\n        <p>Warning: {error}</p>\n        <button onClick={fetchClimateData} className=\"btn btn-secondary\">\n          Try Again\n        </button>\n        <div style={{ marginTop: '1rem' }}>\n          <small>\n            <strong>Troubleshooting:</strong><br/>\n            • Check your internet connection<br/>\n            • The APIs may be temporarily unavailable<br/>\n            • Some locations may not have complete data coverage<br/>\n            • Location: {latitude}, {longitude}\n          </small>\n          {debugInfo && (\n            <div style={{ marginTop: '0.5rem', fontSize: '0.8rem', color: '#666', fontFamily: 'monospace' }}>\n              Debug: {debugInfo}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // 计算数据年份范围用于显示\n  const currentYear = new Date().getFullYear();\n  const endYear = currentYear - 1;\n  const startYear = endYear - 4; // 5年数据\n\n  return (\n    <div className=\"climate-chart-container\">\n      <div className=\"chart-header\">\n        <h3>5-Year Average Climate Data for {location}</h3>\n        <p>\n          Historical data ({startYear}-{endYear}) from{' '}\n          <a href=\"https://power.larc.nasa.gov/\" target=\"_blank\" rel=\"noopener noreferrer\">\n            NASA POWER\n          </a>{' '}\n          and{' '}\n          <a href=\"https://open-meteo.com/\" target=\"_blank\" rel=\"noopener noreferrer\">\n            Open-Meteo\n          </a>{' '}\n          APIs\n        </p>\n      </div>\n      \n      <div className=\"chart-content\">\n        <ChartRenderer\n          climateData={climateData}\n          tooltip={tooltip}\n          showTooltip={showTooltip}\n          hideTooltip={hideTooltip}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default ClimateChart; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}